---
import type { HttpCode } from '../../../types';
import CardAnimada from '../../atomos/CardAnimada.astro';
import HeaderCodes from '../../codes-http/HeaderCodes.astro';
import NoResultsCodes from '../../codes-http/NoResultsCodes.astro';

const { data } = Astro.props as { data: HttpCode[] };
---

<section class="max-w-8xl relative mx-auto flex min-h-screen flex-col items-center">
	<!-- HEADER -->
	<HeaderCodes />

	<!-- GRID -->
	<div id="codes-grid" class="mb-25 flex flex-wrap justify-center gap-x-20 gap-y-16 px-6">
		{
			data.map(code => (
				<div class="http-card" data-code={code.code} data-status={code.status.toLowerCase()}>
					<CardAnimada
						description={code.description}
						image_cover={{
							imageCover: code.images?.[0]?.imageCover,
							alt: code.images?.[0]?.alt
						}}
						image_logo={'https://res.cloudinary.com/dovznesem/image/upload/v1768586804/404__2_-removebg-preview_cgkkr5.png'}
						image_character={{
							imageCharacter: code.images?.[1]?.imageCharacter,
							alt: code.images?.[1]?.alt
						}}
						link={`code/${code.code}`}
						code={code.code}
					/>
				</div>
			))
		}
	</div>

	<NoResultsCodes />
</section>

<script>
	const input = document.getElementById('search-input') as HTMLInputElement;
	const cards = document.querySelectorAll('.http-card') as NodeListOf<HTMLDivElement>;
	const noResults = document.getElementById('no-results') as HTMLParagraphElement;

	if (input) {
		input.addEventListener('input', e => {
			e.preventDefault();
			const value = input.value.toLowerCase();
			console.log(value);
			let visible = 0;

			cards.forEach(card => {
				const code = card.dataset.code;
				const status = card.dataset.status;

				if (!value) {
					card.classList.remove('hidden');
					visible++;
					return;
				}

				if (code?.includes(value) || status?.includes(value)) {
					card.classList.remove('hidden');
					visible++;
				} else {
					card.classList.add('hidden');
				}
			});

			if (visible === 0) {
				noResults.classList.remove('hidden');
			} else {
				noResults.classList.add('hidden');
			}
		});
	}
</script>
